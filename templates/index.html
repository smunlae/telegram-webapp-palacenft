<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>PalaceNFT Offers</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      Telegram.WebApp.ready();

      // Получаем оригинальную строку и удаляем query_id
      let initData = Telegram.WebApp.initData;
      let filtered = initData
        .split("&")
        .filter(p => !p.startsWith("query_id="))
        .join("&");

      // Покажем отладочную инфу
      const debug = document.createElement("pre");
      debug.innerText = "x-user-data:\n" + filtered;
      document.body.appendChild(debug);

      // Отправим на сервер
      fetch("/fetch_offers", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ init_data: filtered })
      })
        .then(res => res.json())
        .then(data => {
          const pre = document.createElement("pre");
          pre.innerText = JSON.stringify(data, null, 2);
          document.body.appendChild(pre);
        })
        .catch(err => {
          const errPre = document.createElement("pre");
          errPre.innerText = "Ошибка: " + err;
          document.body.appendChild(errPre);
        });
    });
  </script>
</head>
<body>
  <h3>Загрузка данных с palacenft.com...</h3>
</body>
</html>
